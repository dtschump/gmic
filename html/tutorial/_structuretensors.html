<!DOCTYPE html>
<html lang="en-us"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="tutorial.css">
<script type="text/javascript" src="highslide/highslide.js"></script>
<link rel="stylesheet" type="text/css" href="highslide/highslide.css" />
<script type="text/javascript">
hs.graphicsDir = 'highslide/graphics/';
hs.wrapperClassName = 'wide-border';
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<body>


      



<h1>-structuretensors</h1>
<p><img src="http://www.particularart.com/static/media/uploads/command_reference/structuretensors/ampersand_st.png" title="Structure of a Goudy Ampersand" class="img_right_nospacetop" style="margin: 3px; border: 0px solid #808080; float: left;" height="300" width="300" /> This command associates <a target="_parent" href="http://en.wikipedia.org/wiki/Structure_tensor">structure tensors</a> with each input pixel, these recording intensity differences and their likely orientations. Such differences, if sufficiently coherent, can be regarded as 'edge-like features', hence the notion that this command makes explicit the 'structure' of an image.</p>
<p>The command produces a structure tensor field of its operand image; this may have three (with 2D inputs) or six (with 3D inputs) channels with each pixel in the output field containing the coefficients definining a structure tensor at the corresponding input pixel.</p>
<p>When the <a target="_parent" href="_display.shtml">-display</a> command renders structure tensor fields, detected edges are the dominant feature, appearing as thin lines not unlike other edge detecting methods. In contrast to those methods, however, -structuretensors also encodes the orientation of those edges. Faux coloring appears where blue indicate horizontal, red vertical, and white oblique orientation. These are visualization conveniences. The key output of this command is the structure tensor associated with each input pixel and the local image structure it conveys.</p>
<p>The structure tensor itself is, for images of one pixel depth, a 2x2 square symmetric matrix, and a 3x3 matrix of similar form for images of depth greater than one. The <a target="_parent" href="http://en.wikipedia.org/wiki/Eigenvectors">eigenvectors</a> of these matrices furnish the orientation of local differences, while the <a target="_parent" href="http://en.wikipedia.org/wiki/Eigenvectors">eigenvalues</a> furnish their magnitudes. These vector and scalar values are latent in the structure tensors. <a target="_parent" href="_eigen.shtml">-eigen</a> computes explicit&nbsp; scalars and vectors from given structure tensor fields.</p>
<p>To determine the local orientation of a feature, this command estimates the gradients along the width, height and depth axes in the immediate neighborhood of the pixel being assayed. The command's single numeric parameter. {0, 1, 2} chooses one of three estimating schemes:</p>
<ol>
<li><em>Centered (0):</em> Along each principle axis, x, y, and possibly z, the command takes the differences between the preceding and following pixels of the one being assayed. Here, "preceding" and "following" are grounded on the left-to-right, top-to-bottom, front-to-back indexing of image pixels. The differences among x, y and z&nbsp;&ndash; ix, iy and iz&nbsp;&ndash; are just these differences divided by two, yielding a "center average" difference. This method of estimating the local gradient may be quickly computed but gives a coarse resolution.</li>
<li><em>Forward-Backward, Versions 1 &amp; 2 (1 &amp; 2):</em> The remaining two schemes take differences between the pixel being assayed and each of its preceding and following neighbors, yielding "forward" and "backward" differences along each of the principle axes: ixf, ixb, iyf, iyb, izf, and izb, a higher resolution sampling. These two schemes are grounded on the same set of differences, but calculate the coefficients of the structure tensors along the main diagonal in different ways. See "Matrix Computations, following.</li>
</ol>
<h2>Matrix Computations</h2>
<p><img src="http://www.particularart.com/static/media/uploads/command_reference/structuretensors/matrixchart.png" title="Coefficient calculations for structure tensor matrices" class="img_block" style="margin: 3px; border: 0px solid #808080;" height="300" width="900" /></p>
<p>The command builds structure tensors from intensity differences&nbsp;&ndash; gradients&nbsp;&ndash; detected in small, 3x3 pixel rectangles (2D) or 3x3x3 cubes (3D) centered on an assay pixel. The end result of the assay is a 2x2 (2D) or 3x3 (3D) symmetrix matrix, so-called because the coefficients in the upper right corner triangle mirror the values of those in the lower left. The schematic above depicts a 3x3 structure tensor. Providentially, the 2x2 structure tensor also appears as a sub-matrix in the upper left corner of the 3x3 matrix. When -structuretensors notes an image depth of one, it only builds the upper left corner.</p>
<p>The command finds the structure tensor coefficients, <em>S<sub>ij</sub></em>, in two phases. The first entails taking differences. Scheme 0 differs from its two counterparts in that it takes only three 'centered differences', to wit: the differences of the immediate neighbors to the assay pixel along each cardinal axis, divided by two, yielding at least two differences with images of depth one, ix, iy, and a third difference iz for images of greater depth.&nbsp;</p>
<p>&nbsp;Schemes 1 and 2 take finer-resolution forward/backward differences involving the assay pixel itself. Under this regimen, the command takes "forward" and "backward" differences between the assay pixel and each of its neighbors along the cardinal axes, yielding at least four differences, ixf, ixb, iyf, and iyb for single pixel depth images, and izf, izb for images of greater depth.</p>
<p>In the second phase, the -structuretensors command takes various products of differences, which become the coefficients of the matrix. Products of differences are apt for detecting any variations in local image intensity. If these differences are small, the products are even smaller, but concomittantly amplify variations for differences larger than one.</p>
<p>For all schemes the main diagonal coefficients are set to products of differences taken only along one the cardinal axes, with <em>S<sub>00 </sub></em>set to those along the X axis, S<sub>11</sub> for those along the Y axis and S<sub>22</sub> for those along the Z axis. For scheme 0, these are simply the square of the center difference, Schemes 1 and 2 employ different averaging methods of the products of forward and backward differences, details given in the preceding chart.</p>
<p>Off-diagonal coefficients arise from products of differences garnered from pairs of axes, the indices of the coefficient selecting particular pairs. For example, coefficient&nbsp;S<sub>02</sub> and S<sub>20</sub> arise from products of differences taken along the X and Z axes. Since the structure tensor is a symmetrix matrix, the computations for these two coefficients are identical, and, generally it is only necessary to calculate the main diagonal and one corner of off-diagonal coefficients. Scheme 0 off-diagonal coefficients are just the products of the two differences from each axis. Schemes 1 and 2 both compute averages of forward and backward differences from each axis. The preceding chart documents the particular calculations.</p>
<p>So far, this discussion of matrix computation suffices for gray scale images. The multispectral extension is straightforward. The command calculates the coefficients for each channel and sums these together for the image aggregate, as indicated by &Sigma;<sub>c</sub> in the schematic of the tensor matrix in the preceding chart.</p>
<h2><img src="http://www.particularart.com/static/media/uploads/command_reference/structuretensors/tnsr_disp.png" title="Various Manifestations of Structure Tensors" class="img_block" style="margin: 3px; border: 0px solid #808080; float: left;" height="640" width="512" />Visualization</h2>
<p>The <a target="_parent" href="_display_tensors.shtml">-display_tensors</a> command visualizes 2x2 tensor fields, taking such as input operands. For each pixel (tensor) in the field, the command renders an ellipse with axes that are proportional to the two eigenvalues. The semimajor axis aligns with the steepest gradient in the locale and the eigenvector pointing along it.</p>
<p>Especially flat or highly eccentric ellipses reflect large differences in the magnitude of the two eigenvalues. The relative discrepancy of the two eigenvalues reflects the degree of <a target="_parent" href="http://en.wikipedia.org/wiki/Isotropy">anisotropy</a> or bias toward a particular orientation. Rounder ellipses arise from eigenvalues closer together in value and reflect gradients that are not as strongly oriented in a particular direction.</p>
<p>The overall saturation and luminance of the ellipse reflect the magnitude of the largest eigenvalue and the rapidity of change of the local gradient.</p>
<p>In the preceding illustration: (upper far left) An image with edges, some edgier than others. (upper near left) After -structuretensors, in faux colors. For 2x2 structure tensors, the command stores coefficient <em>S<sub>00 </sub></em>in channel 0, <em>S<sub>01 </sub></em>in channel 1 and <em>S<sub>11 </sub></em>in channel 2. With this arrangement, structure tensors around horizontal edges render blue and vertical edges render red, the obliques white or nearly black. The <em>S<sub>01 </sub></em>coefficient may be positive or negative and ranges in values around a median of zero, so black - the color no particular edge - renders as a median gray. (near right and far right) <a target="_parent" href="_eigen.shtml">-eigen</a> reads structure tensor fields and produces two images, each with two channels. The first image stores the two eigenvalues, the second the components of the unit eigenvector pointing along the steepest gradient. The other eigenvector is rotated 90&deg; clockwise, so its components may be easily derived. (bottom) <a target="_parent" href="_display_tensors.shtml">-display_tensors</a> visualization of the -structure tensor field, upper near left.&nbsp;</p>
<h2>Related Concepts</h2>
<p>Computing structure tensors is the first stage in finding -diffusiontensors, which, in turn, furnish -smooth with datasets of blending vectors. Users primarily interested in anisotropic smoothing usually do not need to use either -structuretensors or -diffusiontensors directly, unless they wish to tailor these fields for specialized or artistic purposes. &nbsp;</p>
<p><em>Garry Osgood</em></p>



   
</body></html>